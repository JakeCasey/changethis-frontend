{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Fragment } from \"react\";\nimport { Container, Subscribe } from \"unstated\";\nimport PinOverlay from \"./PinOverlay\";\nimport ShowPins from \"./ShowPins\";\nimport shortId from \"shortid\";\nimport _ from \"lodash\";\nimport { frontend, prodFrontend } from \"../../config\";\nvar frontendUrl = process.env.NODE_ENV === \"development\" ? frontend : prodFrontend;\n\nclass Global extends Container {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      overIframe: [],\n      currentIframe: frontendUrl + \"/api/proxy?url=aHR0cDovL2J1Z2hlcmQuY29t\",\n      showPins: true,\n      showCanvas: false,\n      canvas: null,\n      iframe: {\n        size: {\n          height: 0,\n          width: 200\n        }\n      },\n      showToolbarOverlay: false,\n      toolbarOverlayContents: \"\",\n      toolbar: [],\n      isPlacingPin: false,\n      pins: [],\n      text: \"This is some text\"\n    });\n\n    _defineProperty(this, \"addSimpleTextBlock\", () => {\n      this.toggleToolbarOverlay();\n      var simpleText = {\n        id: shortId.generate(),\n        type: \"text\",\n        value: \"test\",\n        label: \"test\"\n      };\n      var toolbar = this.state.toolbar;\n      toolbar.push(simpleText);\n      this.setState({\n        toolbar\n      });\n    });\n\n    _defineProperty(this, \"addPinBlock\", () => {\n      this.toggleToolbarOverlay();\n      this.setState({\n        overIframe: [...this.state.overIframe, {\n          belongsTo: \"test\",\n          component: ShowPins\n        }]\n      });\n      var pin = {\n        id: shortId.generate(),\n        type: \"pin\"\n      }; //place pin view over iframe\n\n      var toolbar = this.state.toolbar;\n      toolbar.push(pin);\n      this.setState({\n        toolbar\n      });\n    });\n\n    _defineProperty(this, \"putComponentInToolbar\", component => {\n      this.setState({\n        toolbarOverlayContents: component\n      });\n    });\n\n    _defineProperty(this, \"toggleToolbarOverlay\", () => {\n      this.setState({\n        showToolbarOverlay: !this.state.showToolbarOverlay\n      });\n    });\n\n    _defineProperty(this, \"togglePinPlacement\", (id, block) => {\n      if (this.state.isPlacingPin) {\n        var stat = this.state.overIframe;\n        stat = _.filter(stat, function (i) {\n          return i.belongsTo != id;\n        });\n        this.setState({\n          overIframe: stat,\n          isPlacingPin: false\n        });\n      } else {\n        this.setState({\n          overIframe: [...this.state.overIframe, {\n            belongsTo: id,\n            component: PinOverlay\n          }],\n          isPlacingPin: true\n        });\n      }\n    });\n\n    _defineProperty(this, \"addPath\", () => {\n      var canvas = this.state.canvas;\n      var path = new fabric.Path(\"M 0 0 L 200 100 L 170 200 z\");\n      path.set({\n        left: 120,\n        top: 120\n      });\n      canvas.add(path);\n      this.setState({\n        canvas\n      });\n    });\n\n    _defineProperty(this, \"addArrow\", () => {\n      var canvas = this.state.canvas;\n      fabric.loadSVGFromURL(\"/static/images/arrow.svg\", function (objects, options) {\n        var obj = fabric.util.groupSVGElements(objects, options);\n        canvas.add(obj).renderAll();\n      });\n      this.setState({\n        canvas\n      });\n    });\n\n    _defineProperty(this, \"showCanvas\", () => {\n      this.setState({\n        showCanvas: true\n      });\n    });\n\n    _defineProperty(this, \"hideCanvas\", () => {\n      this.setState({\n        showCanvas: false\n      });\n    });\n\n    _defineProperty(this, \"instantiateCanvas\", that => {\n      const canvas = new fabric.Canvas(that.c);\n      this.setState({\n        canvas\n      });\n    });\n\n    _defineProperty(this, \"clear\", () => {\n      var canvas = this.state.canvas;\n      var canvas = canvas.clear();\n      this.setState({\n        canvas\n      });\n    });\n\n    _defineProperty(this, \"_placePin\", pin => {\n      pin.id = shortId.generate();\n      var pins = this.state.pins;\n      pins.push(pin);\n      this.setState({\n        pins\n      });\n      console.log(\"Pin placed.\");\n      console.log(this.state);\n    });\n\n    _defineProperty(this, \"_updatePinCommentByID\", (id, text, previousState) => {\n      var that = previousState;\n      _.find(that, {\n        id: id\n      }).comment = text;\n      this.setState({\n        pins: that\n      });\n    });\n\n    _defineProperty(this, \"_loadStateFromHash\", hash => {\n      var hash = atob(hash);\n      var previousState = this.state;\n      hash = JSON.parse(hash);\n      console.log(\"Hash loaded.\");\n      console.log(hash);\n      console.log(PinOverlay());\n\n      if (hash.pins.length > 0) {\n        previousState.overIframe = [...this.state.overIframe, {\n          belongsTo: \"test\",\n          component: ShowPins\n        }, {\n          belongsTo: \"U1iLA0CXQ\",\n          component: PinOverlay\n        }];\n      }\n\n      previousState.pins = hash.pins;\n      previousState.toolbar = hash.toolbar;\n      previousState.currentIframe = hash.currentIframe;\n      previousState.isPlacingPin = false;\n      console.log(previousState.currentIframe); // this.togglePinPlacement(\"test\");\n\n      this.setState(_objectSpread({}, previousState));\n    });\n\n    _defineProperty(this, \"setCurrentIframe\", url => {\n      this.setState({\n        currentIframe: url\n      });\n    });\n  }\n\n}\n\nexport { Global };","map":{"version":3,"sources":["/Users/jakecasey/Documents/Projects/Bugs/skeleton-key-frontend/components/special/Global.js"],"names":["React","Fragment","Container","Subscribe","PinOverlay","ShowPins","shortId","_","frontend","prodFrontend","frontendUrl","process","env","NODE_ENV","Global","overIframe","currentIframe","showPins","showCanvas","canvas","iframe","size","height","width","showToolbarOverlay","toolbarOverlayContents","toolbar","isPlacingPin","pins","text","toggleToolbarOverlay","simpleText","id","generate","type","value","label","state","push","setState","belongsTo","component","pin","block","stat","filter","i","path","fabric","Path","set","left","top","add","loadSVGFromURL","objects","options","obj","util","groupSVGElements","renderAll","that","Canvas","c","clear","console","log","previousState","find","comment","hash","atob","JSON","parse","length","url"],"mappings":"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","sourcesContent":["import React, { Fragment } from \"react\";\nimport { Container, Subscribe } from \"unstated\";\nimport PinOverlay from \"./PinOverlay\";\nimport ShowPins from \"./ShowPins\";\nimport shortId from \"shortid\";\nimport _ from \"lodash\";\nimport { frontend, prodFrontend } from \"../../config\";\n\nvar frontendUrl =\n  process.env.NODE_ENV === \"development\" ? frontend : prodFrontend;\nclass Global extends Container {\n  state = {\n    overIframe: [],\n    currentIframe: frontendUrl + \"/api/proxy?url=aHR0cDovL2J1Z2hlcmQuY29t\",\n    showPins: true,\n    showCanvas: false,\n    canvas: null,\n    iframe: {\n      size: { height: 0, width: 200 }\n    },\n    showToolbarOverlay: false,\n    toolbarOverlayContents: \"\",\n    toolbar: [],\n    isPlacingPin: false,\n    pins: [],\n    text: \"This is some text\"\n  };\n\n  addSimpleTextBlock = () => {\n    this.toggleToolbarOverlay();\n\n    var simpleText = {\n      id: shortId.generate(),\n      type: \"text\",\n      value: \"test\",\n      label: \"test\"\n    };\n\n    var toolbar = this.state.toolbar;\n\n    toolbar.push(simpleText);\n\n    this.setState({ toolbar });\n  };\n\n  addPinBlock = () => {\n    this.toggleToolbarOverlay();\n\n    this.setState({\n      overIframe: [\n        ...this.state.overIframe,\n        { belongsTo: \"test\", component: ShowPins }\n      ]\n    });\n\n    var pin = {\n      id: shortId.generate(),\n      type: \"pin\"\n    };\n\n    //place pin view over iframe\n\n    var toolbar = this.state.toolbar;\n\n    toolbar.push(pin);\n\n    this.setState({ toolbar });\n  };\n\n  putComponentInToolbar = component => {\n    this.setState({ toolbarOverlayContents: component });\n  };\n\n  toggleToolbarOverlay = () => {\n    this.setState({ showToolbarOverlay: !this.state.showToolbarOverlay });\n  };\n\n  togglePinPlacement = (id, block) => {\n    if (this.state.isPlacingPin) {\n      var stat = this.state.overIframe;\n\n      stat = _.filter(stat, function(i) {\n        return i.belongsTo != id;\n      });\n\n      this.setState({\n        overIframe: stat,\n        isPlacingPin: false\n      });\n    } else {\n      this.setState({\n        overIframe: [\n          ...this.state.overIframe,\n          { belongsTo: id, component: PinOverlay }\n        ],\n        isPlacingPin: true\n      });\n    }\n  };\n\n  addPath = () => {\n    var canvas = this.state.canvas;\n    var path = new fabric.Path(\"M 0 0 L 200 100 L 170 200 z\");\n    path.set({ left: 120, top: 120 });\n    canvas.add(path);\n    this.setState({ canvas });\n  };\n\n  addArrow = () => {\n    var canvas = this.state.canvas;\n    fabric.loadSVGFromURL(\"/static/images/arrow.svg\", function(\n      objects,\n      options\n    ) {\n      var obj = fabric.util.groupSVGElements(objects, options);\n      canvas.add(obj).renderAll();\n    });\n    this.setState({ canvas });\n  };\n\n  showCanvas = () => {\n    this.setState({ showCanvas: true });\n  };\n\n  hideCanvas = () => {\n    this.setState({ showCanvas: false });\n  };\n\n  instantiateCanvas = that => {\n    const canvas = new fabric.Canvas(that.c);\n    this.setState({ canvas });\n  };\n\n  clear = () => {\n    var canvas = this.state.canvas;\n    var canvas = canvas.clear();\n    this.setState({ canvas });\n  };\n\n  _placePin = pin => {\n    pin.id = shortId.generate();\n    var pins = this.state.pins;\n    pins.push(pin);\n    this.setState({ pins });\n\n    console.log(\"Pin placed.\");\n    console.log(this.state);\n  };\n\n  _updatePinCommentByID = (id, text, previousState) => {\n    var that = previousState;\n    _.find(that, { id: id }).comment = text;\n    this.setState({ pins: that });\n  };\n\n  _loadStateFromHash = hash => {\n    var hash = atob(hash);\n    var previousState = this.state;\n    hash = JSON.parse(hash);\n    console.log(\"Hash loaded.\");\n    console.log(hash);\n\n    console.log(PinOverlay());\n    if (hash.pins.length > 0) {\n      previousState.overIframe = [\n        ...this.state.overIframe,\n        {\n          belongsTo: \"test\",\n          component: ShowPins\n        },\n        { belongsTo: \"U1iLA0CXQ\", component: PinOverlay }\n      ];\n    }\n    previousState.pins = hash.pins;\n    previousState.toolbar = hash.toolbar;\n    previousState.currentIframe = hash.currentIframe;\n    previousState.isPlacingPin = false;\n    console.log(previousState.currentIframe);\n    // this.togglePinPlacement(\"test\");\n    this.setState({ ...previousState });\n  };\n\n  setCurrentIframe = url => {\n    this.setState({ currentIframe: url });\n  };\n}\n\nexport { Global };\n"]},"metadata":{},"sourceType":"module"}