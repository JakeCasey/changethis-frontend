{"ast":null,"code":"import { prodEndPoint, endpoint } from '../../config'; // import fetch from 'isomorphic-fetch';\n//fucky stuff going on here\n\nexport default (async (req, res) => {\n  try {\n    var newEndpoint = process.env.NODE_ENV === 'production' ? prodEndPoint : endpoint;\n    console.log(newEndpoint);\n    var url = req.url;\n    var fetchUrl = newEndpoint + url;\n    var fetchRes = await fetch(fetchUrl); // console.log(fetchRes);\n\n    const contentType = fetchRes.headers.get('content-type');\n    let response; // if (contentType.includes('text/html')) {\n    //   response = await fetchRes.text();\n    //   res.setHeader('Content-Type', 'text/html');\n    // }\n    // if (contentType.includes('text/css')) {\n    //   response = await fetchRes.text();\n    //   res.setHeader('Content-Type', 'text/css');\n    // }\n    // if (contentType.includes('image/png')) {\n    //   response = fetchRes.text();\n    //   res.setHeader('Content-Type', 'image/png');\n    // }\n\n    response = await fetchRes.text();\n    res.setHeader('Content-Type', contentType); // TODO: these are not serving the correct data formats;\n\n    console.log(contentType);\n\n    if (contentType.includes('image/jpeg')) {\n      console.log('jpeg');\n      res.setHeader('Content-Type', 'image/jpeg');\n      response = await fetchRes.blob();\n      res.send(response);\n      return;\n    }\n\n    if (contentType.includes('image/png')) {\n      console.log('png');\n\n      try {\n        response = await fetchRes.buffer();\n      } catch (error) {\n        if (error) console.log(error);\n      }\n\n      res.end(response, 'binary');\n      return;\n    } // res.send(response);\n\n  } catch (error) {// if (error) throw new Error(error);\n  }\n});","map":{"version":3,"sources":["/Users/jakecasey/Documents/Projects/Bugs/skeleton-key-frontend/pages/api/proxy.js"],"names":["prodEndPoint","endpoint","req","res","newEndpoint","process","env","NODE_ENV","console","log","url","fetchUrl","fetchRes","fetch","contentType","headers","get","response","text","setHeader","includes","blob","send","buffer","error","end"],"mappings":"AAAA,SAASA,YAAT,EAAuBC,QAAvB,QAAuC,cAAvC,C,CACA;AAEA;;AACA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACjC,MAAI;AACF,QAAIC,WAAW,GACbC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwCP,YAAxC,GAAuDC,QADzD;AAEAO,IAAAA,OAAO,CAACC,GAAR,CAAYL,WAAZ;AACA,QAAIM,GAAG,GAAGR,GAAG,CAACQ,GAAd;AACA,QAAIC,QAAQ,GAAGP,WAAW,GAAGM,GAA7B;AAEA,QAAIE,QAAQ,GAAG,MAAMC,KAAK,CAACF,QAAD,CAA1B,CAPE,CAQF;;AACA,UAAMG,WAAW,GAAGF,QAAQ,CAACG,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,CAApB;AAEA,QAAIC,QAAJ,CAXE,CAYF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,IAAAA,QAAQ,GAAG,MAAML,QAAQ,CAACM,IAAT,EAAjB;AACAf,IAAAA,GAAG,CAACgB,SAAJ,CAAc,cAAd,EAA8BL,WAA9B,EA1BE,CA4BF;;AAEAN,IAAAA,OAAO,CAACC,GAAR,CAAYK,WAAZ;;AAEA,QAAIA,WAAW,CAACM,QAAZ,CAAqB,YAArB,CAAJ,EAAwC;AACtCZ,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAN,MAAAA,GAAG,CAACgB,SAAJ,CAAc,cAAd,EAA8B,YAA9B;AACAF,MAAAA,QAAQ,GAAG,MAAML,QAAQ,CAACS,IAAT,EAAjB;AACAlB,MAAAA,GAAG,CAACmB,IAAJ,CAASL,QAAT;AACA;AACD;;AAED,QAAIH,WAAW,CAACM,QAAZ,CAAqB,WAArB,CAAJ,EAAuC;AACrCZ,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;;AAEA,UAAI;AACFQ,QAAAA,QAAQ,GAAG,MAAML,QAAQ,CAACW,MAAT,EAAjB;AACD,OAFD,CAEE,OAAOC,KAAP,EAAc;AACd,YAAIA,KAAJ,EAAWhB,OAAO,CAACC,GAAR,CAAYe,KAAZ;AACZ;;AACDrB,MAAAA,GAAG,CAACsB,GAAJ,CAAQR,QAAR,EAAkB,QAAlB;AACA;AACD,KAlDC,CAoDF;;AACD,GArDD,CAqDE,OAAOO,KAAP,EAAc,CACd;AACD;AACF,CAzDD","sourcesContent":["import { prodEndPoint, endpoint } from '../../config';\n// import fetch from 'isomorphic-fetch';\n\n//fucky stuff going on here\nexport default async (req, res) => {\n  try {\n    var newEndpoint =\n      process.env.NODE_ENV === 'production' ? prodEndPoint : endpoint;\n    console.log(newEndpoint);\n    var url = req.url;\n    var fetchUrl = newEndpoint + url;\n\n    var fetchRes = await fetch(fetchUrl);\n    // console.log(fetchRes);\n    const contentType = fetchRes.headers.get('content-type');\n\n    let response;\n    // if (contentType.includes('text/html')) {\n    //   response = await fetchRes.text();\n    //   res.setHeader('Content-Type', 'text/html');\n    // }\n    // if (contentType.includes('text/css')) {\n    //   response = await fetchRes.text();\n    //   res.setHeader('Content-Type', 'text/css');\n    // }\n    // if (contentType.includes('image/png')) {\n    //   response = fetchRes.text();\n    //   res.setHeader('Content-Type', 'image/png');\n    // }\n\n    response = await fetchRes.text();\n    res.setHeader('Content-Type', contentType);\n\n    // TODO: these are not serving the correct data formats;\n\n    console.log(contentType);\n\n    if (contentType.includes('image/jpeg')) {\n      console.log('jpeg');\n      res.setHeader('Content-Type', 'image/jpeg');\n      response = await fetchRes.blob();\n      res.send(response);\n      return;\n    }\n\n    if (contentType.includes('image/png')) {\n      console.log('png');\n\n      try {\n        response = await fetchRes.buffer();\n      } catch (error) {\n        if (error) console.log(error);\n      }\n      res.end(response, 'binary');\n      return;\n    }\n\n    // res.send(response);\n  } catch (error) {\n    // if (error) throw new Error(error);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}