{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Fragment } from 'react';\nimport { Container, Subscribe } from 'unstated';\nimport PinOverlay from './PinOverlay';\nimport ShowPins from './ShowPins';\nimport shortId from 'shortid';\nimport _ from 'lodash';\n\nvar Global =\n/*#__PURE__*/\nfunction (_Container) {\n  _inherits(Global, _Container);\n\n  function Global() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Global);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Global)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      overIframe: [],\n      currentIframe: 'https://changethisfrontend.deva.io/api/proxy?url=aHR0cDovL3d3dy5nb29nbGUuY29t',\n      showPins: false,\n      showCanvas: false,\n      canvas: null,\n      iframe: {\n        size: {\n          height: 0,\n          width: 200\n        }\n      },\n      showToolbarOverlay: false,\n      toolbarOverlayContents: '',\n      toolbar: [],\n      isPlacingPin: false,\n      pins: [],\n      text: 'This is some text'\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addSimpleTextBlock\", function () {\n      _this.toggleToolbarOverlay();\n\n      var simpleText = {\n        id: shortId.generate(),\n        type: 'text',\n        value: 'test',\n        label: 'test'\n      };\n      var toolbar = _this.state.toolbar;\n      toolbar.push(simpleText);\n\n      _this.setState({\n        toolbar: toolbar\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addPinBlock\", function () {\n      _this.toggleToolbarOverlay();\n\n      _this.setState({\n        overIframe: [].concat(_toConsumableArray(_this.state.overIframe), [{\n          belongsTo: 'test',\n          component: ShowPins\n        }])\n      });\n\n      var pin = {\n        id: shortId.generate(),\n        type: 'pin'\n      }; //place pin view over iframe\n\n      var toolbar = _this.state.toolbar;\n      toolbar.push(pin);\n\n      _this.setState({\n        toolbar: toolbar\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"putComponentInToolbar\", function (component) {\n      _this.setState({\n        toolbarOverlayContents: component\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleToolbarOverlay\", function () {\n      _this.setState({\n        showToolbarOverlay: !_this.state.showToolbarOverlay\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"togglePinPlacement\", function (id, block) {\n      if (_this.state.isPlacingPin) {\n        var stat = _this.state.overIframe;\n        stat = _.filter(stat, function (i) {\n          return i.belongsTo != id;\n        });\n\n        _this.setState({\n          overIframe: stat,\n          isPlacingPin: false\n        });\n      } else {\n        _this.setState({\n          overIframe: [].concat(_toConsumableArray(_this.state.overIframe), [{\n            belongsTo: id,\n            component: PinOverlay\n          }]),\n          isPlacingPin: true\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addPath\", function () {\n      var canvas = _this.state.canvas;\n      var path = new fabric.Path('M 0 0 L 200 100 L 170 200 z');\n      path.set({\n        left: 120,\n        top: 120\n      });\n      canvas.add(path);\n\n      _this.setState({\n        canvas: canvas\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"addArrow\", function () {\n      var canvas = _this.state.canvas;\n      fabric.loadSVGFromURL('/static/images/arrow.svg', function (objects, options) {\n        var obj = fabric.util.groupSVGElements(objects, options);\n        canvas.add(obj).renderAll();\n      });\n\n      _this.setState({\n        canvas: canvas\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showCanvas\", function () {\n      _this.setState({\n        showCanvas: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hideCanvas\", function () {\n      _this.setState({\n        showCanvas: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"instantiateCanvas\", function (that) {\n      var canvas = new fabric.Canvas(that.c);\n\n      _this.setState({\n        canvas: canvas\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"clear\", function () {\n      var canvas = _this.state.canvas;\n      var canvas = canvas.clear();\n\n      _this.setState({\n        canvas: canvas\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_placePin\", function (pin) {\n      pin.id = shortId.generate();\n      var pins = _this.state.pins;\n      pins.push(pin);\n\n      _this.setState({\n        pins: pins\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_updatePinCommentByID\", function (id, text, previousState) {\n      var that = previousState;\n      _.find(that, {\n        id: id\n      }).comment = text;\n\n      _this.setState({\n        pins: that\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_loadStateFromHash\", function (hash) {\n      var test = atob(hash);\n      var previousState = _this.state;\n      test = JSON.parse(test);\n\n      if (test.pins.length > 0) {\n        previousState.overIframe = [].concat(_toConsumableArray(_this.state.overIframe), [{\n          belongsTo: 'test',\n          component: ShowPins\n        }]);\n      }\n\n      previousState.pins = test.pins;\n      previousState.toolbar = test.toolbar;\n\n      _this.setState(_objectSpread({}, previousState));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setCurrentIframe\", function (url) {\n      _this.setState({\n        currentIframe: url\n      });\n    });\n\n    return _this;\n  }\n\n  return Global;\n}(Container);\n\nexport { Global };","map":null,"metadata":{},"sourceType":"module"}